#!/bin/bash
# SPDX-License-Identifier: MulanPSL-2.0+
# Copyright (c) 2020 Huawei Technologies Co., Ltd. All rights reserved.

# fix files permissions cause container service start failed
umask 002

initialize_repo()
{
	local repo="$1"

	[ -d "/c/git-repos/$repo/.git" ] || {
		mkdir -p /c/git-repos/"$repo".git
		cd /c/git-repos/"$repo".git
		git init --bare .
		git clone /c/git-repos/"$repo".git /c/git-repos/"$repo"
	}

	chown -R lkp:committer /c/git-repos

	cd /c/git-repos/"$repo"
	git config --global --add safe.directory /c/git-repos/my_upstreams
	git config user.email "git-mirror@localhost"
	git config user.name "git-mirror"
}

initialize_repo my_upstreams
